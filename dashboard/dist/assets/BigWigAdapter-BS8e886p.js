import{B as b,a as y}from"./bbi-B8gpvmho.js";import{a_ as x,i as B,u as P}from"./rpcWorker-BQYX6MpU.js";import{B as S}from"./index-DMgqHXm-.js";import{r as N}from"./rxjs-CH3jAc9M.js";import"./AbortablePromiseCache-xs5eyOH3.js";import"./Observable-Df53GRV-.js";class v extends b{async getView(t,e){const{zoomLevels:s,refsByName:i,isBigEndian:n,uncompressBufSize:u}=await this.getHeader(e),c=1/t,l=s.length-1;for(let o=l;o>=0;o-=1){const r=s[o];if(r&&r.reductionLevel<=2*c)return new y(this.bbi,i,r.indexOffset,n,u>0,"summary")}return this.getUnzoomedView(e)}}var C=x();class E extends S.BaseFeatureDataAdapter{async setupPre(t){const{statusCallback:e=()=>{}}=t||{},s=this.pluginManager,i=new v({filehandle:B.openLocation(this.getConf("bigWigLocation"),s)}),n=await P.updateStatus("Downloading bigwig header",e,()=>i.getHeader(t));return{bigwig:i,header:n}}async setup(t){return this.setupP||(this.setupP=this.setupPre(t).catch(e=>{throw this.setupP=void 0,e})),this.setupP}async getRefNames(t){const{header:e}=await this.setup(t);return Object.keys(e.refsByName)}async refIdToName(t){var e;const{header:s}=await this.setup();return(e=s.refsByNumber[t])===null||e===void 0?void 0:e.name}async getGlobalStats(t){const{header:e}=await this.setup(t);return C.rectifyStats(e.totalSummary)}getFeatures(t,e={}){const{refName:s,start:i,end:n}=t,{bpPerPx:u=0,stopToken:c,resolution:l=1,statusCallback:o=()=>{}}=e;return N.ObservableCreate(async r=>{o("Downloading bigwig data");const g=this.getConf("source"),f=this.getConf("resolutionMultiplier"),{bigwig:h}=await this.setup(e),m=await h.getFeatures(s,i,n,{...e,basesPerSpan:u/l*f});for(const a of m){g&&(a.source=g);const p=`${g}:${t.refName}:${a.start}-${a.end}`;a.refName=s,a.uniqueId=p,r.next({get:w=>a[w],id:()=>p,toJSON:()=>a})}r.complete()},c)}async getMultiRegionFeatureDensityStats(t){return{featureDensity:0}}freeResources(){}}E.capabilities=["hasResolution","hasLocalStats","hasGlobalStats"];export{E as default};
//# sourceMappingURL=BigWigAdapter-BS8e886p.js.map
